{"ast":null,"code":"import _classCallCheck from\"/Users/braydenarcher/Desktop/Full-Stack Javascript/hw4-CrackingOne933/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/braydenarcher/Desktop/Full-Stack Javascript/hw4-CrackingOne933/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/braydenarcher/Desktop/Full-Stack Javascript/hw4-CrackingOne933/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/braydenarcher/Desktop/Full-Stack Javascript/hw4-CrackingOne933/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{Component}from\"react\";import{Link}from\"react-router-dom\";import\"./SearchAPI\";import CourseCard from\"./CourseCard\";import*as SearchAPI from\"./SearchAPI\";import Pagination from\"./Pagination\";import*as CoursesAPI from\"./CoursesAPI\";import Color from\"./Color\";var SearchPage=/*#__PURE__*/function(_Component){_inherits(SearchPage,_Component);var _super=_createSuper(SearchPage);function SearchPage(){var _this;_classCallCheck(this,SearchPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={coursesBeingDisplayed:[],currentCourses:[],coursesCache:[],response:undefined};_this.updateQuery=function(){var value=document.getElementById(\"searchBar\").value;if(value===\"\"){_this.setState({coursesBeingDisplayed:[],response:undefined});return;}SearchAPI.getResponse(value,1,10).then(function(r){//const newCourses = this.newCoursesList(r.data.data);\n_this.setState({response:r,coursesBeingDisplayed:r.data.data});});};_this.newCoursesList=function(responseData){return responseData.map(function(course){course.status=\"none\";_this.state.coursesCache.forEach(function(c){if(c.title===course.title&&c.term===course.term&&c.number===course.number){course.status=c.status;}});return course;});};_this.onCourseUpdate=function(course,status){if(course.status===\"none\"){console.log(\"Adding from search\",course,status);course.status=status;_this.addCourse(course);return;}var noSkip=true;_this.state.coursesCache.forEach(function(c){console.log(\"Comparing to \",c,course);if(c.title===course.title&&c.term===course.term&&c.number===course.number&&noSkip){console.log(\"Matched!\");course=c;noSkip=false;}});console.log(\"Matched or didnt match in coursesCache ->\",_this.state.coursesCache,course);var _course=course,_id=_course._id;if(status===\"none\"){console.log(\"Removing from search\",course);_this.removeCourse(course);return;}console.log(\"Updating from search\",course,status);CoursesAPI.updateStatus(_id,status).then(function(c){if(c===null){return;}console.log(\"Removing \",course);_this.props.removeCourse(c);_this.setState(function(state){return{coursesCache:state.coursesCache.filter(function(c){return c._id!==course._id;})};},function(){course.status=status;console.log(\"Adding \",course);_this.props.addCourse(c);_this.setState({coursesCache:_this.state.coursesCache.concat(c)});});});};_this.addCourse=function(course){CoursesAPI.add(course).then(function(c){if(c===null){alert(\"Error adding Course\");return;}_this.setState(function(){var temp=_this.state.coursesCache;temp.push(c);console.log(temp);return{courses:temp};},function(){console.log(\"Done Adding. heres cache and course\",_this.state.coursesCache,c);_this.props.addCourse(c);});});};_this.removeCourse=function(course){_this.setState(function(state){return{coursesCache:state.coursesCache.filter(function(c){return c._id!==course._id;})};});CoursesAPI.remove(course._id).then(function(r){if(r===null){alert(\"Error removing course\");}_this.props.removeCourse(r);});};_this.removeCourseLocally=function(course){_this.setState(function(state){return{coursesCache:state.coursesCache.filter(function(c){return c._id!==course._id;})};});};_this.addCourseLocally=function(course){_this.setState(function(){var temp=_this.state.coursesCache;temp.push(course);console.log(temp);return{courses:temp};});};_this.updateView=function(c,status){_this.setState({coursesBeingDisplayed:_this.state.coursesBeingDisplayed.map(function(courses){if(c.title===courses.title&&c.term===courses.term&&c.number===courses.number){return{title:courses.title,term:courses.term,number:courses.number,status:status};}return courses;})});};_this.nextPage=function(){SearchAPI.getResponseWithLink(_this.state.response.data.links.next).then(function(r){var newCourses=_this.newCoursesList(r.data.data);_this.setState({response:r,coursesBeingDisplayed:newCourses});});};_this.previousPage=function(){SearchAPI.getResponseWithLink(_this.state.response.data.links.prev).then(function(r){var newCourses=_this.newCoursesList(r.data.data);_this.setState({response:r,coursesBeingDisplayed:newCourses});});};_this.firstPage=function(){SearchAPI.getResponseWithLink(_this.state.response.data.links.first).then(function(r){var newCourses=_this.newCoursesList(r.data.data);_this.setState({response:r,coursesBeingDisplayed:newCourses});});};_this.lastPage=function(){SearchAPI.getResponseWithLink(_this.state.response.data.links.last).then(function(r){var newCourses=_this.newCoursesList(r.data.data);_this.setState({response:r,coursesBeingDisplayed:newCourses});});};return _this;}_createClass(SearchPage,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;CoursesAPI.getAll().then(function(courses){return _this2.setState({coursesCache:courses});});}},{key:\"render\",value:function render(){var _this3=this;var coursesBeforeUpdate=this.state.coursesBeingDisplayed;var courses=this.newCoursesList(coursesBeforeUpdate);var response=this.state.response===undefined?undefined:this.state.response.data;var pagination=response===undefined?undefined:response.pagination;console.log(\"Rendering!!!\");return/*#__PURE__*/_jsxs(\"div\",{className:\"search-courses\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-courses-bar\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{className:\"close-search\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"search-courses-input-wrapper\",children:/*#__PURE__*/_jsx(\"input\",{id:\"searchBar\",type:\"text\",placeholder:\"Search by course title or course number\",onInput:this.updateQuery})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-courses-results\",children:[/*#__PURE__*/_jsx(\"ol\",{className:\"courses-grid\",children:courses.map(function(course,index){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(CourseCard,{course:course,color:Color.getColor(course.title),props:_this3.props,onCourseUpdate:_this3.onCourseUpdate})},index);})}),/*#__PURE__*/_jsx(\"div\",{className:\"search-courses-buttons\",children:/*#__PURE__*/_jsx(Pagination,{pagination:pagination,nextPage:this.nextPage,previousPage:this.previousPage,firstPage:this.firstPage,lastPage:this.lastPage})})]})]});}}]);return SearchPage;}(Component);export default SearchPage;","map":{"version":3,"sources":["/Users/braydenarcher/Desktop/Full-Stack Javascript/hw4-CrackingOne933/src/Search.js"],"names":["React","Component","Link","CourseCard","SearchAPI","Pagination","CoursesAPI","Color","SearchPage","state","coursesBeingDisplayed","currentCourses","coursesCache","response","undefined","updateQuery","value","document","getElementById","setState","getResponse","then","r","data","newCoursesList","responseData","map","course","status","forEach","c","title","term","number","onCourseUpdate","console","log","addCourse","noSkip","_id","removeCourse","updateStatus","props","filter","concat","add","alert","temp","push","courses","remove","removeCourseLocally","addCourseLocally","updateView","nextPage","getResponseWithLink","links","next","newCourses","previousPage","prev","firstPage","first","lastPage","last","getAll","coursesBeforeUpdate","pagination","index","getColor"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport {Link} from \"react-router-dom\";\nimport PropTypes from \"prop-types\";\nimport \"./SearchAPI\"\nimport CourseCard from \"./CourseCard\";\nimport * as SearchAPI from \"./SearchAPI\";\nimport Pagination from \"./Pagination\";\nimport * as CoursesAPI from \"./CoursesAPI\";\nimport Color from \"./Color\";\n\nclass SearchPage extends Component {\n    state = {\n        coursesBeingDisplayed: [],\n        currentCourses: [],\n        coursesCache: [],\n        response: undefined,\n    }\n\n    componentDidMount() {\n        CoursesAPI.getAll().then((courses) => this.setState({ coursesCache: courses }));\n    }\n\n    updateQuery = () => {\n        const value = document.getElementById(\"searchBar\").value;\n        if (value === \"\") {\n            this.setState({coursesBeingDisplayed: [], response: undefined});\n            return;\n        }\n        SearchAPI.getResponse(value, 1, 10)\n            .then(r => {\n                //const newCourses = this.newCoursesList(r.data.data);\n                this.setState({ response: r, coursesBeingDisplayed: r.data.data});\n            });\n    }\n\n\n\n    newCoursesList = (responseData) => {\n        return responseData.map((course) => {\n            course.status = \"none\";\n            this.state.coursesCache.forEach((c) => {\n                if (c.title === course.title && c.term === course.term && c.number === course.number) {\n                    course.status = c.status;\n                }\n            });\n            return course;\n        });\n    }\n\n\n    /*onCourseUpdate = (course, status) =>  {\n        let skip = false;\n        CoursesAPI.getAll().then((courses) => {\n            courses.every((c) => {\n                if (c.title === course.title && c.term === course.term && c.number === course.number) {\n                    if (status === \"none\") {\n                        this.props.removeCourse(c._id);\n                    } else {\n                        this.props.onCourseUpdate(c._id, status);\n                    }\n                    skip = true;\n                    return true;\n                }\n                return false;\n            });\n            if (!skip) {\n                course.status = status;\n                this.props.addCourse(course);\n            }\n            CoursesAPI.getAll().then((courses) => this.setState({ coursesBeingDisplayed: courses }, () => {\n                console.log(\"UPDATE\");\n                console.log(this.state.coursesBeingDisplayed);\n            }));\n        });*/\n\n       /* let skip = false;\n        console.log(\"Current courses\", this.state.currentCourses);\n        this.setState({currentCourses: this.props.getCourses()}, () => {\n            this.state.currentCourses.every((c) => {\n                if (c.title === course.title && c.term === course.term && c.number === course.number) {\n                    if(status === \"none\") {\n                        this.props.removeCourse(c);\n                    } else {\n                        this.props.onCourseUpdate(c, status);\n                    }\n                    this.refresh();\n                    skip = true;\n                    return true;\n                }\n                return false;\n            });\n            if(!skip) {\n                course.status = status;\n                this.props.addCourse(course);\n                this.refresh();\n            }\n        });*/\n\n        /*if(course._id !== undefined) {\n            this.state.currentCourses.every((c) => {\n                if (c.title === course.title && c.term === course.term && c.number === course.number) {\n                    this.updateView(course, status);\n                    this.props.onCourseUpdate(c, status);\n                    if (status === \"none\") {\n                        this.setState((state) => {\n                            return {\n                                currentCourses: state.currentCourses.filter((tempCourse) => {\n                                    return `${tempCourse._id}` !== c._id;\n                                }),\n                            };\n                        });\n                    }\n                    return true;\n                }\n                return false;\n            });\n            return;\n        }\n        let newCourse = course;\n        newCourse.status = status;\n        CoursesAPI.add(newCourse).then(c => {\n            if (c === null) {\n                return;\n            }\n            this.setState({\n                currentCourses: this.state.currentCourses.concat(c)\n            }, () => {\n                /!*this.updateView(course, status);\n                this.props.onCourseUpdate(c, status);*!/\n            });\n        });*/\n    //}\n\n    onCourseUpdate = (course, status) => {\n        if (course.status === \"none\") {\n            console.log(\"Adding from search\", course, status);\n            course.status = status;\n            this.addCourse(course);\n            return;\n        }\n        let noSkip = true;\n        this.state.coursesCache.forEach((c) => {\n            console.log(\"Comparing to \", c, course);\n            if (c.title === course.title && c.term === course.term && c.number === course.number && noSkip) {\n                console.log(\"Matched!\");\n                course = c;\n                noSkip = false;\n            }\n        });\n        console.log(\"Matched or didnt match in coursesCache ->\", this.state.coursesCache, course);\n\n        const { _id } = course;\n        if (status === \"none\") {\n            console.log(\"Removing from search\", course);\n            this.removeCourse(course);\n            return;\n        }\n        console.log(\"Updating from search\", course, status);\n        CoursesAPI.updateStatus(_id, status).then(c => {\n            if (c === null) {\n                return;\n            }\n            console.log(\"Removing \", course);\n            this.props.removeCourse(c);\n            this.setState((state) => {\n                return {\n                    coursesCache: state.coursesCache.filter((c) => c._id !== course._id),\n                };\n            }, () => {\n                course.status = status;\n                console.log(\"Adding \", course);\n                this.props.addCourse(c);\n                this.setState({\n                    coursesCache: this.state.coursesCache.concat(c)\n                });\n            });\n        });\n\n    }\n\n    addCourse = (course) => {\n        CoursesAPI.add(course).then((c) => {\n            if (c === null) {\n                alert(\"Error adding Course\");\n                return;\n            }\n            this.setState(() => {\n                const temp = this.state.coursesCache;\n                temp.push(c);\n                console.log(temp);\n                return {courses: temp};\n            }, ()=> {\n                console.log(\"Done Adding. heres cache and course\", this.state.coursesCache, c);\n                this.props.addCourse(c);\n            });\n        });\n    };\n\n    removeCourse = (course) => {\n        this.setState((state) => {\n            return {\n                coursesCache: state.coursesCache.filter((c) => c._id !== course._id),\n            };\n        });\n        CoursesAPI.remove(course._id).then(r => {\n            if (r === null) {\n                alert(\"Error removing course\");\n            }\n            this.props.removeCourse(r);\n        });\n    };\n\n    removeCourseLocally = (course) => {\n        this.setState((state) => {\n            return {\n                coursesCache: state.coursesCache.filter((c) => c._id !== course._id),\n            };\n        });\n    }\n\n    addCourseLocally = (course) => {\n        this.setState(() => {\n            const temp = this.state.coursesCache;\n            temp.push(course);\n            console.log(temp);\n            return {courses: temp};\n        });\n    }\n\n\n    updateView = (c, status) => {\n        this.setState({ coursesBeingDisplayed: this.state.coursesBeingDisplayed.map((courses) => {\n                if (c.title === courses.title && c.term === courses.term && c.number === courses.number) {\n                    return {\n                        title: courses.title,\n                        term: courses.term,\n                        number: courses.number,\n                        status: status,\n                    };\n                }\n                return courses;\n            })});\n    }\n\n    nextPage = () => {\n        SearchAPI.getResponseWithLink(this.state.response.data.links.next)\n            .then(r => {\n                const newCourses = this.newCoursesList(r.data.data);\n                this.setState({ response: r, coursesBeingDisplayed: newCourses});\n            });\n    }\n\n    previousPage = () => {\n        SearchAPI.getResponseWithLink(this.state.response.data.links.prev)\n            .then(r => {\n                const newCourses = this.newCoursesList(r.data.data);\n                this.setState({ response: r, coursesBeingDisplayed: newCourses});\n            });\n    }\n\n    firstPage = () => {\n        SearchAPI.getResponseWithLink(this.state.response.data.links.first)\n            .then(r => {\n                const newCourses = this.newCoursesList(r.data.data);\n                this.setState({ response: r, coursesBeingDisplayed: newCourses});\n            });\n    }\n\n    lastPage = () => {\n        SearchAPI.getResponseWithLink(this.state.response.data.links.last)\n            .then(r => {\n                const newCourses = this.newCoursesList(r.data.data);\n                this.setState({ response: r, coursesBeingDisplayed: newCourses});\n            });\n    }\n\n    render() {\n        const coursesBeforeUpdate = this.state.coursesBeingDisplayed;\n        const courses = this.newCoursesList(coursesBeforeUpdate);\n\n        const response = this.state.response === undefined ? undefined: this.state.response.data;\n        const pagination = response === undefined ? undefined: response.pagination;\n        console.log(\"Rendering!!!\");\n        return (\n            <div className=\"search-courses\">\n                <div className=\"search-courses-bar\">\n                    <Link to=\"/\">\n                        <button className=\"close-search\" />\n                    </Link>\n                    <div className=\"search-courses-input-wrapper\">\n                        <input\n                            id=\"searchBar\"\n                            type=\"text\"\n                            placeholder=\"Search by course title or course number\"\n                            onInput={this.updateQuery}\n                        />\n                    </div>\n                </div>\n                <div className=\"search-courses-results\">\n                    <ol className=\"courses-grid\">\n                        {\n                            courses.map(\n                                (course, index) => {\n                                    return (<li key={index}>\n                                        <CourseCard\n                                            course={course}\n                                            color={Color.getColor(course.title)}\n                                            props={this.props}\n                                            onCourseUpdate={this.onCourseUpdate}\n                                        />\n                                    </li>);\n                                }\n                            )\n                        }\n                    </ol>\n                    <div className=\"search-courses-buttons\">\n                        <Pagination\n                            pagination={pagination}\n                            nextPage={this.nextPage}\n                            previousPage={this.previousPage}\n                            firstPage={this.firstPage}\n                            lastPage={this.lastPage}\n                        />\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default SearchPage;\n\nSearchPage.propTypes = {\n    onCourseUpdate: PropTypes.func.isRequired,\n    getCourses: PropTypes.func.isRequired,\n    addCourse: PropTypes.func.isRequired,\n    removeCourse: PropTypes.func.isRequired\n};\n"]},"metadata":{},"sourceType":"module"}